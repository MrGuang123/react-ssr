(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("fs");var a=e.n(t);const r=require("path");var n=e.n(r);const o=require("koa");var l=e.n(o);const c=require("@koa/router");var s=e.n(c);const u=require("koa-static");var d=e.n(u);const i=require("react");var m=e.n(i);const h=require("react-dom/server"),p=require("react-router-dom"),g=require("react-router-dom/server"),v=require("react-redux"),E=function(){return m().createElement(m().Fragment,null,m().createElement("main",null,m().createElement("h2",null,"Welcome to the homepage!")),m().createElement("nav",null,m().createElement(p.Link,{to:"/about"},"to About")))},q=require("axios");var y=e.n(q);function f(e){const[t,a]=(0,i.useState)([]);return(0,i.useEffect)((()=>{console.log("props.data",e.data),e.data||y().get("http://localhost:3200/getData").then((t=>{console.log("receive data: ",t.data),e.dispatch({type:"change",payload:{data:t.data.data}})}))}),[e.data]),m().createElement(m().Fragment,null,m().createElement("main",null,m().createElement("h2",null,"about page"),m().createElement("div",null,e.data&&e.data.map((e=>m().createElement("p",{key:e.id},`${e.id} : ${e.name}`))))),m().createElement("nav",null,m().createElement(p.Link,{to:"/"},"to Home")))}f.service={getData:e=>new Promise((t=>{y().get("http://localhost:3200/getData").then((a=>{e.dispatch({type:"change",payload:{data:a.data.data}}),t(a.data.data)}))}))};const w=(0,v.connect)((function(e){return{data:e.data}}),(function(e){return{dispatch:e}}))(f),b=[{path:"/",element:m().createElement(E,null)},{path:"/about",element:m().createElement(w,null),loadData:w.service.getData}],S=require("redux"),D={data:null};function k(e=D,t){return"change"===t.type?{...e,...t.payload}:{...e}}const P=()=>m().createElement("div",null,m().createElement("h1",null,"hello world"),(0,p.useRoutes)(b)),x=new(l()),O=new(s());x.use(d()("assets")),console.log("__dirname",process.cwd()),O.get(["/","/about"],(async(e,t)=>{const r=(c=a().readFileSync(("index.html",n().resolve("/","index.html")),"utf8"),e=>c.replace(/<!--(\s\S)*?-->/,((t,a)=>e[a.toString().trim()]))),o=(0,S.createStore)(k),l=[];var c;b.some((t=>{const a=(0,p.matchPath)(e.request.path,t.path);return console.log("match",a,e.request.path,t.path),a&&t.loadData&&l.push(t.loadData(o)),a})),console.log("promises",l),await Promise.all(l).then((e=>{console.log("server data: ",e)}));const s=(0,h.renderToString)(m().createElement(v.Provider,{store:o},m().createElement(g.StaticRouter,{location:e.req.url},m().createElement(P,null))));e.body=r({injectdom:s,injectstore:`<script>window.REDUX_STORE = ${JSON.stringify(o.getState())}<\/script>`})})),O.get("/getData",(e=>{e.body={code:0,message:"success",data:[{id:1,name:"hello"},{id:2,name:"world"}]}})),x.use(O.routes()).use(O.allowedMethods()),x.listen(3200,(()=>{console.log("server is running at http://localhost:3200 ")}))})();